{
    "id": "venda_planos_dinamico",
    "name": "Venda de Planos Din√¢mica",
    "description": "Exemplo de fluxo que usa a nova step 'select_plan' para buscar planos do dashboard.",
    "trigger": "/planos_dinamico",
    "entry_step": "welcome",
    "version": "1.0.0",
    "steps": {
        "welcome": {
            "type": "molecule",
            "action": "send_message",
            "params": {
                "text": "üëã Ol√°! Vamos escolher seu plano?\n\nMe diga seu <b>nome</b>:",
                "parse_mode": "HTML"
            },
            "next_step": "collect_name"
        },
        "collect_name": {
            "type": "molecule",
            "action": "collect_input",
            "params": {
                "variable": "customer_name",
                "validation": "any"
            },
            "next_step": "show_dynamic_plans"
        },
        "show_dynamic_plans": {
            "type": "molecule",
            "action": "select_plan",
            "params": {
                "text": "Excelente, {{session.customer_name}}! üéØ\n\nAbaixo est√£o os planos configurados no seu <b>Dashboard</b>:"
            },
            "next_step": "confirm_order"
        },
        "confirm_order": {
            "type": "molecule",
            "action": "send_message",
            "params": {
                "text": "‚úÖ <b>Plano Selecionado!</b>\n\n‚Ä¢ Plano: {{session.plan_name}}\n‚Ä¢ Valor: <b>{{session.plan_currency}} {{session.plan_price}}</b>\n\nPodemos gerar o link de pagamento?",
                "parse_mode": "HTML"
            },
            "next_step": "ask_payment_confirmation"
        },
        "ask_payment_confirmation": {
            "type": "molecule",
            "action": "inline_keyboard",
            "params": {
                "text": "Confirmar?",
                "buttons": [
                    {
                        "text": "üí≥ Sim, gerar PIX",
                        "callback": "pay_yes"
                    },
                    {
                        "text": "‚ùå Cancelar",
                        "callback": "pay_no"
                    }
                ]
            },
            "next_step": "collect_pay_confirmation"
        },
        "collect_pay_confirmation": {
            "type": "molecule",
            "action": "collect_input",
            "params": {
                "variable": "pay_choice",
                "validation": "any"
            },
            "next_step": "process_payment"
        },
        "process_payment": {
            "type": "molecule",
            "action": "condition",
            "params": {
                "expression": "{{session.pay_choice}} == 'pay_yes'",
                "true_step": "generate_checkout",
                "false_step": "cancel"
            }
        },
        "generate_checkout": {
            "type": "molecule",
            "action": "send_webapp",
            "params": {
                "text": "üéâ Quase l√°! Clique abaixo para pagar seu plano <b>{{session.plan_name}}</b>:",
                "button_text": "üí≥ PAGAR AGORA",
                "page_id": "checkout",
                "parse_mode": "HTML"
            },
            "next_step": null
        },
        "cancel": {
            "type": "molecule",
            "action": "send_message",
            "params": {
                "text": "Sem problemas. Se precisar, √© s√≥ chamar! üëã",
                "parse_mode": "HTML"
            },
            "next_step": null
        }
    },
    "metadata": {
        "author": "Sistema",
        "category": "vendas",
        "tags": [
            "dinamico",
            "planos",
            "dashboard"
        ]
    }
}
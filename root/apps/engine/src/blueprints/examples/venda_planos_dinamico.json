{
    "id": "venda_planos_dinamico",
    "name": "Venda de Planos Din√¢mica",
    "description": "Exemplo de fluxo que usa a nova step 'select_plan' para buscar planos do dashboard e gerar PIX.",
    "trigger": "/planos_dinamico",
    "entry_step": "welcome",
    "version": "1.1.0",
    "steps": {
        "welcome": {
            "type": "organism",
            "action": "prompt",
            "params": {
                "text": "üëã Ol√°! Bem-vindo ao nosso atendimento.\n\nVamos escolher seu plano?\n\nMe diga seu <b>nome</b>:",
                "parse_mode": "HTML",
                "variable": "customer_name"
            },
            "next_step": "show_dynamic_plans"
        },
        "show_dynamic_plans": {
            "type": "molecule",
            "action": "select_plan",
            "params": {
                "text": "Excelente, {{session.customer_name}}! üéØ\n\nAbaixo est√£o os planos configurados no seu <b>Dashboard</b>:"
            },
            "next_step": "confirm_order"
        },
        "confirm_order": {
            "type": "organism",
            "action": "prompt",
            "params": {
                "text": "‚úÖ <b>Plano Selecionado!</b>\n\n‚Ä¢ Plano: {{session.plan_name}}\n‚Ä¢ Valor: <b>{{session.plan_currency}} {{session.plan_price}}</b>\n\nPodemos gerar o link de pagamento?",
                "parse_mode": "HTML",
                "buttons": [
                    {
                        "text": "üí≥ Sim, gerar PIX",
                        "callback": "pay_yes"
                    },
                    {
                        "text": "‚ùå Cancelar",
                        "callback": "pay_no"
                    }
                ],
                "variable": "pay_choice"
            },
            "next_step": "process_payment"
        },
        "process_payment": {
            "type": "molecule",
            "action": "condition",
            "params": {
                "operator": "equals",
                "variable": "pay_choice",
                "value": "pay_yes"
            },
            "next_step": "generate_checkout",
            "on_false": "cancel"
        },
        "generate_checkout": {
            "type": "molecule",
            "action": "generate_pix",
            "params": {
                "plan_id": "{{session.plan_id}}",
                "description": "Pagamento Plano {{session.plan_name}}",
                "message": "üíé <b>Checkout de Assinatura</b>\n\nOl√° <b>{{session.customer_name}}</b>, aqui est√° o seu QR Code para o plano <b>{{pix_description}}</b>.\n\nüíµ Total: <b>{{pix_amount}}</b>\n\nüì± <b>PIX Copia e Cola:</b>\n<code>{{pix_code}}</code>\n\n‚è∞ Este c√≥digo expira em {{pix_expiration}} minutos.\n\n<i>Ap√≥s o pagamento, seu acesso ser√° liberado automaticamente.</i>"
            },
            "next_step": null
        },
        "cancel": {
            "type": "molecule",
            "action": "send_message",
            "params": {
                "text": "Sem problemas. Se precisar, √© s√≥ chamar! üëã",
                "parse_mode": "HTML"
            },
            "next_step": null
        }
    },
    "metadata": {
        "author": "Sistema",
        "category": "vendas",
        "tags": [
            "dinamico",
            "planos",
            "dashboard",
            "pix"
        ]
    }
}
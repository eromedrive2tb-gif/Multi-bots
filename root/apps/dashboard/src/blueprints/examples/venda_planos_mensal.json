{
    "id": "venda_planos_mensal",
    "name": "Venda de Planos Mensal - Exemplo Completo",
    "description": "Blueprint de exemplo demonstrando um fluxo completo de auto-atendimento para venda de planos mensais. Inclui: boas-vindas, coleta de dados, seleÃ§Ã£o de plano, confirmaÃ§Ã£o e link de pagamento.",
    "trigger": "/planos",
    "entry_step": "welcome",
    "version": "1.0.0",
    "steps": {
        "welcome": {
            "type": "molecule",
            "action": "send_message",
            "params": {
                "text": "ğŸ‰ <b>Bem-vindo ao nosso sistema de assinaturas!</b>\n\nAqui vocÃª pode assinar um de nossos planos mensais premium.\n\nğŸ“¦ Temos opÃ§Ãµes para todos os perfis:\nâ€¢ Plano BÃ¡sico - Para iniciantes\nâ€¢ Plano Pro - Para profissionais\nâ€¢ Plano Enterprise - Para empresas\n\nVamos comeÃ§ar? Me diga seu <b>nome completo</b> para continuarmos:",
                "parse_mode": "HTML"
            },
            "next_step": "collect_name",
            "on_error": "error_handler"
        },
        "collect_name": {
            "type": "molecule",
            "action": "collect_input",
            "params": {
                "variable": "customer_name",
                "validation": "any",
                "timeout_seconds": 120,
                "prompt_on_invalid": "Por favor, digite seu nome completo (mÃ­nimo 3 caracteres):"
            },
            "next_step": "log_name_collected",
            "on_error": "error_handler"
        },
        "log_name_collected": {
            "type": "atom",
            "action": "log",
            "params": {
                "message": "ğŸ“ Nome coletado: {{session.customer_name}}",
                "level": "info"
            },
            "next_step": "ask_email"
        },
        "ask_email": {
            "type": "molecule",
            "action": "send_message",
            "params": {
                "text": "Ã“timo, {{session.customer_name}}! ğŸ‘‹\n\nAgora preciso do seu <b>email</b> para enviar a confirmaÃ§Ã£o do plano:",
                "parse_mode": "HTML"
            },
            "next_step": "collect_email"
        },
        "collect_email": {
            "type": "molecule",
            "action": "collect_input",
            "params": {
                "variable": "customer_email",
                "validation": "email",
                "timeout_seconds": 120,
                "prompt_on_invalid": "âŒ Email invÃ¡lido. Por favor, digite um email vÃ¡lido (ex: seu@email.com):"
            },
            "next_step": "log_email_collected",
            "on_error": "error_handler"
        },
        "log_email_collected": {
            "type": "atom",
            "action": "log",
            "params": {
                "message": "ğŸ“§ Email coletado: {{session.customer_email}} | Cliente: {{session.customer_name}}",
                "level": "info"
            },
            "next_step": "ask_phone"
        },
        "ask_phone": {
            "type": "molecule",
            "action": "send_message",
            "params": {
                "text": "Perfeito! ğŸ“§\n\nAgora, qual seu <b>telefone com DDD</b>?\n\n<i>(Ex: 11999998888)</i>",
                "parse_mode": "HTML"
            },
            "next_step": "collect_phone"
        },
        "collect_phone": {
            "type": "molecule",
            "action": "collect_input",
            "params": {
                "variable": "customer_phone",
                "validation": "phone",
                "timeout_seconds": 120,
                "prompt_on_invalid": "âŒ Telefone invÃ¡lido. Digite apenas nÃºmeros com DDD (ex: 11999998888):"
            },
            "next_step": "log_phone_collected",
            "on_error": "error_handler"
        },
        "log_phone_collected": {
            "type": "atom",
            "action": "log",
            "params": {
                "message": "ğŸ“± Telefone coletado: {{session.customer_phone}} | Cliente: {{session.customer_name}} ({{session.customer_email}})",
                "level": "info"
            },
            "next_step": "show_plans"
        },
        "show_plans": {
            "type": "molecule",
            "action": "inline_keyboard",
            "params": {
                "text": "Excelente, {{session.customer_name}}! ğŸ¯\n\nAgora escolha o plano ideal para vocÃª:\n\nğŸ’ <b>Plano BÃ¡sico</b> - R$ 29,90/mÃªs\nâ€¢ 5 acessos por dia\nâ€¢ Suporte por email\nâ€¢ RelatÃ³rios bÃ¡sicos\n\nâ­ <b>Plano Pro</b> - R$ 79,90/mÃªs\nâ€¢ Acessos ilimitados\nâ€¢ Suporte prioritÃ¡rio\nâ€¢ RelatÃ³rios avanÃ§ados\nâ€¢ API Access\n\nğŸ¢ <b>Plano Enterprise</b> - R$ 199,90/mÃªs\nâ€¢ Tudo do Pro\nâ€¢ Gerente dedicado\nâ€¢ Treinamento incluso\nâ€¢ SLA 99.9%",
                "buttons": [
                    {
                        "text": "ğŸ’ BÃ¡sico R$29,90",
                        "callback": "plan_basic"
                    },
                    {
                        "text": "â­ Pro R$79,90",
                        "callback": "plan_pro"
                    },
                    {
                        "text": "ğŸ¢ Enterprise R$199,90",
                        "callback": "plan_enterprise"
                    }
                ]
            },
            "next_step": "collect_plan_choice",
            "on_error": "error_handler"
        },
        "collect_plan_choice": {
            "type": "molecule",
            "action": "collect_input",
            "params": {
                "variable": "selected_plan",
                "validation": "any",
                "timeout_seconds": 180
            },
            "next_step": "process_plan_selection",
            "on_error": "timeout_handler"
        },
        "process_plan_selection": {
            "type": "molecule",
            "action": "condition",
            "params": {
                "expression": "{{session.selected_plan}} == 'plan_basic'",
                "true_step": "set_plan_basic",
                "false_step": "check_plan_pro"
            }
        },
        "set_plan_basic": {
            "type": "atom",
            "action": "set_variable",
            "params": {
                "variable": "plan_name",
                "value": "Plano BÃ¡sico"
            },
            "next_step": "set_plan_basic_price"
        },
        "set_plan_basic_price": {
            "type": "atom",
            "action": "set_variable",
            "params": {
                "variable": "plan_price",
                "value": "29,90"
            },
            "next_step": "confirm_order"
        },
        "check_plan_pro": {
            "type": "molecule",
            "action": "condition",
            "params": {
                "expression": "{{session.selected_plan}} == 'plan_pro'",
                "true_step": "set_plan_pro",
                "false_step": "set_plan_enterprise"
            }
        },
        "set_plan_pro": {
            "type": "atom",
            "action": "set_variable",
            "params": {
                "variable": "plan_name",
                "value": "Plano Pro"
            },
            "next_step": "set_plan_pro_price"
        },
        "set_plan_pro_price": {
            "type": "atom",
            "action": "set_variable",
            "params": {
                "variable": "plan_price",
                "value": "79,90"
            },
            "next_step": "confirm_order"
        },
        "set_plan_enterprise": {
            "type": "atom",
            "action": "set_variable",
            "params": {
                "variable": "plan_name",
                "value": "Plano Enterprise"
            },
            "next_step": "set_plan_enterprise_price"
        },
        "set_plan_enterprise_price": {
            "type": "atom",
            "action": "set_variable",
            "params": {
                "variable": "plan_price",
                "value": "199,90"
            },
            "next_step": "confirm_order"
        },
        "confirm_order": {
            "type": "molecule",
            "action": "log",
            "params": {
                "message": "ğŸ›’ PEDIDO CRIADO | Plano: {{session.plan_name}} | PreÃ§o: R${{session.plan_price}} | Cliente: {{session.customer_name}} | Email: {{session.customer_email}} | Tel: {{session.customer_phone}}",
                "level": "info"
            },
            "next_step": "show_confirmation"
        },
        "show_confirmation": {
            "type": "molecule",
            "action": "send_message",
            "params": {
                "text": "ğŸ“‹ <b>CONFIRMAÃ‡ÃƒO DO PEDIDO</b>\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ‘¤ <b>Dados do Cliente:</b>\nâ€¢ Nome: {{session.customer_name}}\nâ€¢ Email: {{session.customer_email}}\nâ€¢ Telefone: {{session.customer_phone}}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“¦ <b>Plano Selecionado:</b>\nâ€¢ {{session.plan_name}}\nâ€¢ Valor: <b>R$ {{session.plan_price}}/mÃªs</b>\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nâš ï¸ <i>Confira os dados acima antes de prosseguir.</i>",
                "parse_mode": "HTML"
            },
            "next_step": "ask_confirmation"
        },
        "ask_confirmation": {
            "type": "molecule",
            "action": "inline_keyboard",
            "params": {
                "text": "EstÃ¡ tudo correto? ğŸ¤”",
                "buttons": [
                    {
                        "text": "âœ… Confirmar e Pagar",
                        "callback": "confirm_yes"
                    },
                    {
                        "text": "âŒ Cancelar",
                        "callback": "confirm_no"
                    },
                    {
                        "text": "ğŸ”„ Alterar Plano",
                        "callback": "change_plan"
                    }
                ]
            },
            "next_step": "collect_confirmation"
        },
        "collect_confirmation": {
            "type": "molecule",
            "action": "collect_input",
            "params": {
                "variable": "confirmation_choice",
                "validation": "any",
                "timeout_seconds": 180
            },
            "next_step": "process_confirmation",
            "on_error": "timeout_handler"
        },
        "process_confirmation": {
            "type": "molecule",
            "action": "condition",
            "params": {
                "expression": "{{session.confirmation_choice}} == 'confirm_yes'",
                "true_step": "generate_payment",
                "false_step": "check_cancel"
            }
        },
        "check_cancel": {
            "type": "molecule",
            "action": "condition",
            "params": {
                "expression": "{{session.confirmation_choice}} == 'confirm_no'",
                "true_step": "cancel_order",
                "false_step": "restart_plan_selection"
            }
        },
        "cancel_order": {
            "type": "molecule",
            "action": "log",
            "params": {
                "message": "âŒ PEDIDO CANCELADO | Cliente: {{session.customer_name}} | Email: {{session.customer_email}}",
                "level": "warning"
            },
            "next_step": "send_cancel_message"
        },
        "send_cancel_message": {
            "type": "molecule",
            "action": "send_message",
            "params": {
                "text": "ğŸ˜¢ Pedido cancelado.\n\nSe mudar de ideia, Ã© sÃ³ digitar /planos novamente!\n\nTerremos o melhor plano esperando por vocÃª. ğŸ’™",
                "parse_mode": "HTML"
            },
            "next_step": null
        },
        "restart_plan_selection": {
            "type": "molecule",
            "action": "send_message",
            "params": {
                "text": "ğŸ”„ Sem problemas! Vamos escolher outro plano.",
                "parse_mode": "HTML"
            },
            "next_step": "show_plans"
        },
        "generate_payment": {
            "type": "molecule",
            "action": "log",
            "params": {
                "message": "ğŸ’³ PAGAMENTO INICIADO | Plano: {{session.plan_name}} | Valor: R${{session.plan_price}} | Cliente: {{session.customer_name}} ({{session.customer_email}})",
                "level": "info"
            },
            "next_step": "send_payment_link"
        },
        "send_payment_link": {
            "type": "molecule",
            "action": "send_message",
            "params": {
                "text": "ğŸ‰ <b>Excelente escolha, {{session.customer_name}}!</b>\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ’³ <b>LINK DE PAGAMENTO</b>\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nğŸ“¦ Plano: <b>{{session.plan_name}}</b>\nğŸ’° Valor: <b>R$ {{session.plan_price}}/mÃªs</b>\n\nğŸ‘‡ Clique no botÃ£o abaixo para pagar:\n\nğŸ”— <a href=\"https://seusite.com/checkout?plan={{session.selected_plan}}&email={{session.customer_email}}\">PAGAR AQUI</a>\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nâ° Este link expira em <b>30 minutos</b>.\nğŸ“§ ApÃ³s o pagamento, vocÃª receberÃ¡ a confirmaÃ§Ã£o no email informado.\n\nğŸ’¬ Qualquer dÃºvida, digite /ajuda",
                "parse_mode": "HTML"
            },
            "next_step": "final_log"
        },
        "final_log": {
            "type": "atom",
            "action": "log",
            "params": {
                "message": "âœ… FLUXO COMPLETO | Cliente: {{session.customer_name}} | Email: {{session.customer_email}} | Tel: {{session.customer_phone}} | Plano: {{session.plan_name}} | Valor: R${{session.plan_price}}",
                "level": "info"
            },
            "next_step": null
        },
        "error_handler": {
            "type": "molecule",
            "action": "log",
            "params": {
                "message": "âŒ ERRO NO FLUXO | Step atual: {{session.currentStepId}} | UsuÃ¡rio: {{ctx.userId}}",
                "level": "error"
            },
            "next_step": "send_error_message"
        },
        "send_error_message": {
            "type": "molecule",
            "action": "send_message",
            "params": {
                "text": "ğŸ˜• Ops! Algo deu errado.\n\nPor favor, tente novamente digitando /planos\n\nSe o problema persistir, entre em contato com nosso suporte: /ajuda",
                "parse_mode": "HTML"
            },
            "next_step": null
        },
        "timeout_handler": {
            "type": "molecule",
            "action": "send_message",
            "params": {
                "text": "â° O tempo para sua escolha expirou.\n\nSe ainda deseja continuar, digite /planos para recomeÃ§ar.\n\nEstamos aqui quando precisar! ğŸ’™",
                "parse_mode": "HTML"
            },
            "next_step": null
        }
    },
    "metadata": {
        "author": "Sistema",
        "category": "vendas",
        "tags": [
            "planos",
            "assinatura",
            "pagamento",
            "coleta-dados"
        ],
        "estimated_duration_minutes": 3,
        "complexity": "advanced"
    }
}